<!DOCTYPE html>
<!-- This site was created in Webflow. https://www.webflow.com -->
<!-- Last Published: Thu May 18 2023 15:06:15 GMT+0000 (Coordinated Universal Time) -->
<html data-wf-domain="">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>JudgeGPT</title>

        <!-- Bookstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

        <style>
            .message 
            {
                background-color: #f5f6f7;
            }

            .message.alt
            {
                background-color: #eeeeee
            }

            .messageContents 
            {

            }
            .sender 
            {
            }

            .judge > .sender
            {
                font-weight: bold;
            }

            .plaintiff > .sender,
            #winner.plaintiff
            {
                color: blue;
            }

            .defendant > .sender,
            #winner.defendant
            {
                color: green;
            }
        </style>

    </head>

    <body class="body">

        <!-- Bookstrap -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
  
            <h1 class="logo">JudgeGPT</h1>

            <div id="chat"></div>
            <div id="typing"></div>

            <div id="inputGroup">
                <input  id="userInput" type="text" placeholder="Plaintiff" value="" />
                <button id="submitButton" class="button w-button" onclick="Next()">
                    Submit
                </button>
            </div>

            <div id="winner"></div>
            


    <script>


        // Define global variables
        const chatDiv = document.getElementById('chat');
        const winnerDiv = document.getElementById('winner');
        const submitButton = document.getElementById('submitButton');
        const userInputFeild = document.getElementById('userInput');
        const inputGroup = document.getElementById('inputGroup');
        const typingDiv = document.getElementById('typing');

        //const caseDiv = document.getElementById('case');
        const outputDiv = document.getElementById('output');
        let progressInterval = {};

        let player = {};
        player[0] = {};
        player[0].name = "Plaintiff";
        player[0].instruction = "Plaintiff, do you have anything to add?";
        player[0].testimony;
        player[0].class = "plaintiff"

        player[1] = {};
        player[1].name = "Defendant";
        player[1].instruction = "Defendant, what is your repsonse?";
        player[1].testimony;
        player[1].class = "defendant"

        let judge = {}
        judge.name = "JudgeGPT";
        judge.class = "judge"

        var turn = 0;

        var gameCase = "undefined";
        var casePrompt = "Come up with an abusrd or hilarious accursation to be argued in court between two parties.";
        
        let messages = {};
        messages.count = 0;

        var ruling = "";

        Start();

        // Define asynchronous function to send data
        async function Start() {

            inputGroup.hidden = true;
            gameCase = await AskGPT(casePrompt);
            AddToChat(judge, gameCase);
            UpdateGameState();
            inputGroup.hidden = false;

        }

        function AddToChat(playerSpeaking, chat)
        {
            messages[messages.count] = {};
            messages[messages.count].sender = playerSpeaking;
            messages[messages.count].message = chat;
            messages.count++;

            const newChat = document.createElement('div');
            newChat.classList.add("row");
            newChat.classList.add("message");
            newChat.classList.add(playerSpeaking.class);

            if(messages.count % 2 == 0)
                newChat.classList.add("alt");


            const messageContents = document.createElement('div');
            messageContents.classList.add("col");
            //messageContents.classList.add("messageContents");
            messageContents.classList.add("rounded-3");
            messageContents.innerText = chat;
            

            const sender = document.createElement('div');
            sender.classList.add("col-2");
            sender.classList.add("sender");

            if(messages.count <= 1 || messages[messages.count-2].sender != playerSpeaking)
            {
                sender.innerText = playerSpeaking.name+": ";
            }

            newChat.appendChild(sender);
            newChat.appendChild(messageContents);
            chatDiv.appendChild(newChat);
        }

        function UpdateGameState()
        {
            console.log(player.name);
            console.log(player[turn]);
            console.log(player[turn].instruction);
            //instructionFeild.innerText = ;
            AddToChat(judge, player[turn].instruction);
            userInputFeild.value = "";
            userInputFeild.placeholder = player[turn].name;
        }

        

        // Define asynchronous function to send data
        async function Next() {

                player[turn].testimony = userInputFeild.value;

                AddToChat(player[turn], player[turn].testimony);

                if(turn == 0)
                {
                    turn++;
                    UpdateGameState();
                }else
                    DrawConclusion();
        }

        async function DrawConclusion() 
        {
            // Disable the submit button
            submitButton.disabled = true;

            inputGroup.hidden = true;
            var prompt = "You are a judge in a televised small claims court TV show. You are creating a story and drawing your conclusion and announcing the verdict based on the following evidence.  Justify your verdict. The case is: {" + gameCase + "}. The Plaintiff testimony is: {" + player[0].testimony + "} The Defendant defence testimony is: {" + player[1].testimony + "}";
            ruling = await AskGPT(prompt);
            AddToChat(judge, ruling);

            prompt = "Provide a funny, absurd and unfitting punishment and lesson to be learnt for the following court ruling: {" + ruling+"}";
            var punishment = await AskGPT(prompt);
            AddToChat(judge, punishment);

            prompt = "A judge rulled the following: {"+ruling+"} Give a single word repsonse of who is the winner, Plaintiff, Defendant or neither. "
            var winner = await AskGPT(prompt);
            winnerDiv.innerText = "Winner: " + winner;
           if(winner.toLowerCase().includes(player[1].name.toLowerCase()))
                winnerDiv.classList.add(player[1].class);
            else
                winnerDiv.classList.add(player[0].class);

        }

        async function AskGPT(input)
        {

            // Set interval for progress updates
            AskingGPTInterval = setInterval(async function(){

                typingDiv.innerText += ".";

                if(typingDiv.innerText == "....")
                {
                    typingDiv.innerText = "";
                }

                //interval
            }, 250);  // Interval of 2 seconds

            try {
                console.log("progressInterval = setInterval(async function(){\n                try {");

                // Make POST request to updateUnFake
                const response = await fetch('https://brennan.games:3000/AskGPT', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: input }),
                });
                
                // Parse response data
                const data = await response.json();
                clearInterval(AskingGPTInterval);
                typingDiv.innerText="";
               return data.generatedText;

                //ReadText(data.generatedText);

            } catch(error) {
                // If an error occurs, log it and update loading element
                console.error("Error fetching update: ", error);
                clearInterval(AskingGPTInterval);
                typingDiv.innerText="";
                return "Server unresponsive...";
            }
        }

    </script>
    </body>
</html>