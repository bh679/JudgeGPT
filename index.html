<!DOCTYPE html>
<!-- This site was created in Webflow. https://www.webflow.com -->
<!-- Last Published: Thu May 18 2023 15:06:15 GMT+0000 (Coordinated Universal Time) -->
<html data-wf-domain="">
    <head>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-1760E3YTQP"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-1760E3YTQP');
        </script>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>JudgeGPT</title>

        <!-- Bookstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

        <!-- Judge GPT Style Shee -->
        <link rel="stylesheet" type="text/css" href="./style.css">

        <!-- -->
        <script src="backgroundImages.js"></script>

    </head>

    <body class="body">

        <!-- Bookstrap -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

        <div id="background">
            <!-- This div will serve as your background. -->
        </div>
        
        <div id="page">
  
            <h1 >JudgeGPT</h1>

            <div id="subheading"></div>

            <div id="chat"></div>
            <div id="typing"></div>

            <div id="winner">
            </div>


            <div id="endButtons">
                <div class="row">
                    <button id="restartButton" class="button w-button col" onclick="AiRespond()">
                        Restart
                    </button>
                    <button id="analysisButton" class="button w-button col" onclick="Analysis()">
                        Analyze Responses
                    </button>
                </div>
                <div id="analysisGroup" class="row">
                    <div id="analysis0" class="Analysis col-6"></div>
                    <div id="analysis1" class="Analysis col-6"></div>
                </div>
            </div>


            <div id="inputGroup" class="row">
                <input  id="userInput" type="text" placeholder="Plaintiff" value="" class="col-7" oninput="TypeIntoInput()"/>
                <button id="submitButton" class="button w-button col-2" onclick="Next()">
                    Submit
                </button>
                <button id="aiRespondButton" class="button w-button col-2" onclick="AiRespond()">
                    AI Response
                </button>
            </div>



        
        </div>

    <script>


        // Define global variables
        const chatDiv = document.getElementById('chat');
        const winnerDiv = document.getElementById('winner');

        const analysisGroup = document.getElementById('analysisGroup');
        const analysisButton = document.getElementById('analysisButton')
        const analysis = {};
        analysis[0] = document.getElementById('analysis0');
        analysis[1] = document.getElementById('analysis1');
        endButtons = document.getElementById('endButtons');
        const restartButton = document.getElementById('restartButton');

        const submitButton = document.getElementById('submitButton');
        const aiRespondButton = document.getElementById('aiRespondButton');
        const userInputFeild = document.getElementById('userInput');
        const inputGroup = document.getElementById('inputGroup');
        const typingDiv = document.getElementById('typing');

        const restartButtonLabels = [
            "Initiate New Trial",
            "Reset Legal Matrix",
            "Begin Fresh Plea",
            "Invoke Retrial Protocol",
            "Restart Judicial Simulation",
            "Reset Case Parameters",
            "New Litigation Configuration",
            "Commence New Proceedings",
            "Reinitialize Justice Sequence",
            "Resurrect Case from Archive"
        ];
        restartButtonLabelsCount = 10;

        //const caseDiv = document.getElementById('case');
        const outputDiv = document.getElementById('output');
        let progressInterval = {};

        let player = {};
        player[0] = {};
        player[0].name = "";
        player[0].role = "Plaintiff";
        player[0].instruction = "Plaintiff, do you have anything to add?";
        player[0].testimony;
        player[0].class = "plaintiff";

        player[1] = {};
        player[1].name = "";
        player[1].role = "Defendant";
        player[1].instruction = "Defendant, what is your repsonse?";
        player[1].testimony;
        player[1].class = "defendant";

        let judge = {}
        judge.name = "GPT";
        judge.role = "Judge";
        judge.class = "judge";

        var turn = 0;

        var gameCase = "undefined";
        
        var prompts = {};
        prompts.judgeCharacter = "You are JudgeGPT, a judge in a televised small claims court TV show. You are similar to Judge Judy.";
        prompts.cases = [ "Come up with an abusrd and/or hilarious accursation to be argued in small claims court between two parties.",//" ("+player[0].role + "&" +player[1].role+ ")",
        "Come up with an abusrd and/or hilarious accursation to be argued in court between two parties.",
        "Come up with a rediculous and hilarious accursation to be argued in court between two parties."];
        prompts.punishment = "Provide a funny, absurd and unfitting punishment and lesson to be learnt for the following court ruling:{$}";
        prompts.winner = "A judge rulled the following: {$} Give a single word repsonse of who is the winner, "+player[0].role +", "+player[1].role +" or neither. ";
        prompts.scoring = "You are scoring the result of a text based improve game, by %. Score the setence on each of the four metrics, creativity, intelligence, humor and provide explinations on each. The sentence to be scored is {$}. At the end, provide a total score.";

        let messages = {};
        messages.count = 0;

        var ruling = "";

        Start();

        SetBackground();


        // Define asynchronous function to send data
        async function Start() {

           //* 
            endButtons.hidden = true;
            inputGroup.hidden = true;
            analysisGroup.hidden = true;
            gameCase = await AskGPT(prompts.cases[Math.floor(Math.random() * 3)]);
            AddToChat(judge, gameCase);
            UpdateGameState();
            inputGroup.hidden = false;

            LogDiscordMessages();/*/

            var imageUrl = GetImage(gameCase);
            console.log(imageUrl);
            const  img = document.createElement('img');
            img.src = imageUrl;
            inputGroup.appendChild(img);//*/

        }

        //var players = 0;
        function SwitchHuman(playerId)
        {
            player[playerId].human = !player[playerId].human;

            if(player[playerId].human)
                playerTypeButton[playerId].innerText = "Human";
            else
                playerTypeButton[playerId].innerText = "AI";
        }

        function AddToChat(playerSpeaking, chat)
        {
            messages[messages.count] = {};
            messages[messages.count].sender = playerSpeaking;
            messages[messages.count].message = chat;
            messages[messages.count].discord = false;
            messages.count++;

            const newChat = document.createElement('div');
            newChat.classList.add("row");
            newChat.classList.add("message");
            newChat.classList.add(playerSpeaking.class);

            if(messages.count % 2 == 0)
                newChat.classList.add("alt");


            const messageContents = document.createElement('div');
            messageContents.classList.add("col");
            //messageContents.classList.add("messageContents");
            messageContents.classList.add("rounded-3");
            messageContents.innerText = chat;
            

            const sender = document.createElement('div');
            sender.classList.add("col-2");
            sender.classList.add("sender");

            if(messages.count <= 1 || messages[messages.count-2].sender != playerSpeaking)
            {
                sender.innerText = playerSpeaking.role + " "+ playerSpeaking.name+": ";
            }

            newChat.appendChild(sender);
            newChat.appendChild(messageContents);
            chatDiv.appendChild(newChat);
        }

        function UpdateGameState()
        {

            AddToChat(judge, player[turn].instruction);
            userInputFeild.value = "";
            userInputFeild.placeholder = player[turn].role + " " + player[turn].name;

        }

        async function AiRespond()
        {
            aiRespondButton.disabled = true;
            console.log(turn);
            console.log(player[turn].role);
            prompt =  "You are " + player[turn].role + player[turn].name + " in court case " + gameCase + ". Make a very breif testimonal, and include some suprising, abusrd and/or funny new information.";//prompts.punishment.replace("$", ruling);
            console.log(prompt);
            var testimonial = await AskGPT(prompt);
            userInputFeild.value = testimonial;
            aiRespondButton.disabled = false;
            //AddToChat(player[turn], testimonial);

            //Next();
        }

        

        // Define asynchronous function to send data
        async function Next() {

            player[turn].testimony = userInputFeild.value;

            AddToChat(player[turn], player[turn].testimony);

            if(turn == 0)
            {
                turn++;
                UpdateGameState();

                LogDiscordMessages();
            }else
                DrawConclusion();

            aiRespondButton.disabled = false;

        }

        function TypeIntoInput()
        {
            aiRespondButton.disabled = userInputFeild.value.length > 0;
        }

        async function DrawConclusion() 
        {
            // Disable the submit button
            submitButton.disabled = true;
            inputGroup.hidden = true;

            var prompt = prompts.judgeCharacter  + "You are creating a story and drawing your conclusion and announcing the verdict based on the following evidence.  Justify your verdict. The case is: {" + gameCase + "}. The "+player[0].role+"'s' testimony is: {" + player[0].testimony + "} The "+player[1].role+"'s' defence testimony is: {" + player[1].testimony + "}";
            ruling = await AskGPT(prompt);
            AddToChat(judge, ruling);

            prompt =  prompts.punishment.replace("$", ruling);
            console.log(prompt);
            var punishment = await AskGPT(prompt);
            AddToChat(judge, punishment);

            prompt = prompts.winner.replace("$", ruling);
            var winner = await AskGPT(prompt);
            winnerDiv.innerText = "Winner: " + winner;
           if(winner.toLowerCase().includes(player[1].role.toLowerCase()))
                winnerDiv.classList.add(player[1].class);
            else
                winnerDiv.classList.add(player[0].class);

            LogDiscordMessages();  


            analysisGroup.hidden = false;
            endButtons.hidden = false;
            restartButton.innerText = restartButtonLabels[Math.floor(Math.random() * restartButtonLabelsCount)];
            restartButton.onclick = function() {
              location.reload();
            };

        }

        async function Analysis()
        {
            analysisGroup.hidden = false;
            analysisButton.hidden = true;
            prompt =  prompts.scoring.replace("$", player[0].testimony).replace("%", player[0].role);
            console.log(prompt);
            var p0Score = await AskGPT(prompt);
            analysis[0].innerText = player[0].role +"\n"+player[0].testimony + "\n\n" + p0Score;


            prompt =  prompts.scoring.replace("$", player[1].testimony).replace("%", player[1].role);
            console.log(prompt);
            var p1Score = await AskGPT(prompt);
            analysis[1].innerText = player[1].role +"\n"+player[1].testimony+ "\n\n" + p1Score;
        }

        async function AskGPT(input)
        {

            // Set interval for progress updates
            AskingGPTInterval = setInterval(async function(){

                typingDiv.innerText += ".";

                if(typingDiv.innerText == ".....")
                {
                    typingDiv.innerText = ".";
                }

                //interval
            }, 250);  // Interval of 2 seconds

            try {
                console.log("progressInterval = setInterval(async function(){\n                try {");

                // Make POST request to updateUnFake
                const response = await fetch('https://brennan.games:3000/AskGPT', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: input }),
                });
                
                // Parse response data
                const data = await response.json();
                clearInterval(AskingGPTInterval);
                typingDiv.innerText="";
               return data.generatedText;

                //ReadText(data.generatedText);

            } catch(error) {
                // If an error occurs, log it and update loading element
                console.error("Error fetching update: ", error);
                clearInterval(AskingGPTInterval);
                typingDiv.innerText="";
                return "Server unresponsive...";
            }
        }



        async function GetImage(input)
        {


            try {
                console.log("progressInterval = setInterval(async function(){\n                try {");

                // Make POST request to updateUnFake
                const response = await fetch('https://brennan.games:3000/MJImage', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: input }),
                });
                
                // Parse response data
                const data = await response.json();
                console.log(data);
                console.log(data.image);
                return data.image;

            } catch(error) {
                // If an error occurs, log it and update loading element
                console.error("Error fetching update: ", error);
                clearInterval(AskingGPTInterval);
                typingDiv.innerText="";
                return "Server unresponsive...";
            }
        }


        async function LogDiscordMessages()
        {
            for(var i =0 ;i  < messages.count; i++)
            {
                if(messages[i].discord == false)
                {
                    
                    
                    var response = await fetch('https://brennan.games:3000/DiscrdWebHook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: messages[i].sender.role + " " + messages[i].sender.name + ": " + messages[i].message }),
                });  

                    console.log(repsonse);

                    messages[i].discord = true;
                }
            }
        }

        async function SendMessage(input) {
          const response = await fetch('https://brennan.games:3000/DiscrdWebHook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: input }),
                });
        }

    </script>
    </body>
</html>